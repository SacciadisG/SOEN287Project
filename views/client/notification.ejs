<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notifications</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" 
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> 
    <link rel="stylesheet" href="../../css/notification.css">
</head>
<body>
    <%- include("../partials/client_navbar") %>
    <%- include('../partials/flash_messages') %>
    
    <div class="container mt-4">
        <h1 class="mb-4">Notifications</h1>

        <!-- Notifications Section -->
        <div id="notifications" class="mb-4"></div>

        <!-- Purchased Services Section -->
        <div class="mb-4">
            <% if (purchasedServices && purchasedServices.length > 0) { %>
                <% purchasedServices.forEach(purchase => { %>
                    <% if (purchase.status === 'confirmed') { %>
                        <div class="alert alert-success d-flex justify-content-between align-items-center">
                            <span>
                                <strong>Notification:</strong> You purchased the service "<%= purchase.service.name %>". 
                                <strong>Status:</strong> 
                                <span style="color: green;"><%= purchase.status %></span>
                            </span>
                            <button class="btn-close" onclick="this.parentElement.remove()" aria-label="Close"></button>
                        </div>
                    <% } else if (purchase.status === 'rejected') { %>
                        <div class="alert alert-danger d-flex justify-content-between align-items-center">
                            <span>
                                <strong>Notification:</strong> Your purchase for the service "<%= purchase.service.name %>" was rejected. 
                                <strong>Status:</strong> 
                                <span style="color: red;"><%= purchase.status %></span>
                            </span>
                            <button class="btn-close" onclick="this.parentElement.remove()" aria-label="Close"></button>
                        </div>
                    <% } else if (purchase.status === 'pending') { %>
                        <div class="alert alert-warning d-flex justify-content-between align-items-center">
                            <span>
                                <strong>Notification:</strong> Your purchase for the service "<%= purchase.service.name %>" is still pending. 
                                <strong>Status:</strong> 
                                <span style="color: grey;"><%= purchase.status %></span>
                            </span>
                            <button class="btn-close" onclick="this.parentElement.remove()" aria-label="Close"></button>
                        </div>
                    <% } %>
                <% }); %>
                
            <% } else { %>
                <div class="alert alert-info">
                    <strong>Notification:</strong> No purchased services found.
                </div>
            <% } %>
        </div>

        <!-- Back Button -->
        <div class="text-center">
            <button class="btn btn-secondary" onclick="goBack()">Go Back</button>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
        // Notifications array (can be updated dynamically)
        // Example: const notifications = [...]; 

        // Render notifications
        function renderNotifications() {
            const notificationsContainer = document.getElementById('notifications');
            notificationsContainer.innerHTML = ''; // Clear existing notifications
            notifications.forEach(notification => {
                const alertDiv = document.createElement('div');
                alertDiv.className = `alert alert-${notification.type} d-flex justify-content-between align-items-center`;
                alertDiv.innerHTML = `
                    <span>${notification.message}</span>
                    <button class="btn-close" onclick="removeNotification(this)" aria-label="Close"></button>
                `;
                notificationsContainer.appendChild(alertDiv);
            });
        }

        // Remove a notification
        function removeNotification(button) {
            button.parentElement.remove();
        }

        // Go back to the previous page
        function goBack() {
            window.history.back();
        }

        // Initialize notifications on page load
        renderNotifications();
    </script>

    <!-- Bootstrap Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" 
        integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" 
        integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
</body>
<footer>
    <%- include("../partials/footer") %>
</footer>
</html>
